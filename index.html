<!DOCTYPE html> 
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thay avatar v√†o khung</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    canvas {
      max-width: 100%;
      height: auto;
      border: 1px solid #ddd;
      border-radius: 10px;
    }
    .controls {
      margin-top: 15px;
    }
    input[type="range"] {
      width: 80%;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background: green;
      color: white;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.85;
    }

    /* üîπ Th√¥ng tin li√™n h·ªá */
    .contact {
      margin: 25px auto 0;
      background: #e0f3ff; /* xanh nh·∫°t */
      padding: 12px 25px;
      border-radius: 10px;
      display: inline-block;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }
    .contact h3 {
      margin-bottom: 10px;
      color: #0077b6;
      font-size: 18px;
      font-weight: bold;
    }
    .contact-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 25px; /* kho·∫£ng c√°ch gi·ªØa SDT v√† FB */
    }
    .contact-item {
      display: flex;
      align-items: center;
      font-size: 14px;
    }
    .contact-item img {
      width: 20px;
      height: 20px;
      margin-right: 6px;
    }
    .contact-item a {
      text-decoration: none;
      color: #0077b6;
      font-weight: bold;
    }
    .contact-item a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h2>Ch√®n Avatar v√†o Khung</h2>
  <canvas id="canvas"></canvas>

  <div class="controls">
    <label>Zoom: <input type="range" id="zoom" min="0.5" max="2" step="0.01" value="1"></label><br>
    <label>Xoay: <input type="range" id="rotate" min="0" max="360" step="1" value="0"></label><br>
    <button id="flip">L·∫≠t ·∫£nh</button><br>
    <input type="file" id="upload" accept="image/*"><br>
    <button id="download">T·∫£i v·ªÅ</button>
  </div>

  <!-- üîπ Th√¥ng tin li√™n h·ªá -->
  <div class="contact">
    <h3>Design</h3>
    <div class="contact-row">
      <div class="contact-item">
        <img src="https://img.icons8.com/ios-filled/50/000000/phone.png" alt="Phone">
        <a href="http://zaloapp.com/qr/p/4fdr2pc9vu2k" target="_blank">0833.515.106</a>
      </div>
      <div class="contact-item">
        <img src="https://img.icons8.com/ios-filled/50/000000/facebook-new.png" alt="Facebook">
        <a href="https://www.facebook.com/share/1NP3AHGEhc/" target="_blank">Le Tri Kien (TrKien)</a>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    const upload = document.getElementById("upload");
    const zoom = document.getElementById("zoom");
    const rotate = document.getElementById("rotate");
    const flip = document.getElementById("flip");
    const download = document.getElementById("download");

    let userImg = null;
    let frameImg = new Image();
    frameImg.src = "KHUNG 2.9 FAST MEDIA ( dung luong nhe ).png"; // üëâ ƒê·∫∑t file khung c√πng th∆∞ m·ª•c

    let scale = 1, rotation = 0, flipped = false;
    let posX = 0, posY = 0;
    let dragging = false, lastX, lastY;

    // Resize canvas
    function resizeCanvas() {
      const size = Math.round(window.innerWidth > 500 ? 500 : window.innerWidth - 40);
      const dpr = window.devicePixelRatio || 1;

      canvas.width = size * dpr;
      canvas.height = size * dpr;
      canvas.style.width = size + "px";
      canvas.style.height = size + "px";

      ctx.setTransform(1, 0, 0, 1, 0, 0); 
      ctx.scale(dpr, dpr);

      draw();
    }

    function draw() {
      const displayWidth = parseInt(canvas.style.width);
      const displayHeight = parseInt(canvas.style.height);

      ctx.clearRect(0, 0, displayWidth, displayHeight);

      if (userImg) {
        ctx.save();
        ctx.translate(displayWidth / 2 + posX, displayHeight / 2 + posY);
        ctx.rotate(rotation * Math.PI / 180);
        ctx.scale(flipped ? -scale : scale, scale);

        // üîπ Avatar lu√¥n fit 80% canvas
        const maxSize = Math.min(displayWidth, displayHeight) * 0.8;
        const ratio = Math.min(maxSize / userImg.width, maxSize / userImg.height);

        ctx.drawImage(
          userImg,
          -userImg.width * ratio / 2,
          -userImg.height * ratio / 2,
          userImg.width * ratio,
          userImg.height * ratio
        );

        ctx.restore();
      }

      ctx.drawImage(frameImg, 0, 0, displayWidth, displayHeight);
    }

    // Upload ·∫£nh
    upload.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          userImg = new Image();
          userImg.onload = () => {
            posX = 0; 
            posY = 0;
            scale = 1; // reset zoom khi load ·∫£nh m·ªõi
            draw();
          };
          userImg.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Zoom, xoay
    zoom.addEventListener("input", () => {
      scale = parseFloat(zoom.value);
      draw();
    });

    rotate.addEventListener("input", () => {
      rotation = parseFloat(rotate.value);
      draw();
    });

    flip.addEventListener("click", () => {
      flipped = !flipped;
      draw();
    });

    // K√©o ·∫£nh
    canvas.addEventListener("mousedown", (e) => {
      dragging = true;
      lastX = e.offsetX;
      lastY = e.offsetY;
    });
    canvas.addEventListener("mouseup", () => dragging = false);
    canvas.addEventListener("mouseleave", () => dragging = false);
    canvas.addEventListener("mousemove", (e) => {
      if (dragging) {
        posX += e.offsetX - lastX;
        posY += e.offsetY - lastY;
        lastX = e.offsetX;
        lastY = e.offsetY;
        draw();
      }
    });

    // Touch di chuy·ªÉn
    canvas.addEventListener("touchstart", (e) => {
      dragging = true;
      const touch = e.touches[0];
      lastX = touch.clientX;
      lastY = touch.clientY;
    });
    canvas.addEventListener("touchend", () => dragging = false);
    canvas.addEventListener("touchmove", (e) => {
      if (dragging) {
        const touch = e.touches[0];
        posX += touch.clientX - lastX;
        posY += touch.clientY - lastY;
        lastX = touch.clientX;
        lastY = touch.clientY;
        draw();
      }
    });

    // T·∫£i ·∫£nh
    download.addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "avatar.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });

    window.addEventListener("resize", resizeCanvas);
    frameImg.onload = resizeCanvas;
  </script>
</body>
</html>
